from django.db import models
from .scan import Scan


class Severity(models.TextChoices):
    CRITICAL = "CRITICAL", "Crítica"
    HIGH = "HIGH", "Alta"
    MEDIUM = "MEDIUM", "Média"
    LOW = "LOW", "Baixa"
    INFO = "INFO", "Informativa"


class StatusVulnerability(models.TextChoices):
    ABERTA = "ABERTA", "Aberta"
    IGNORADA = "IGNORADA", "Ignorada"
    CORRIGIDA = "CORRIGIDA", "Corrigida"
    ACEITA = "ACEITA", "Aceita"


class Vulnerability(models.Model):
    scan = models.ForeignKey(
        Scan,
        on_delete=models.CASCADE,
        related_name="vulnerabilidades",
        verbose_name="Scan"
    )
    cve = models.CharField("CVE", max_length=50, blank=True, null=True)
    descricao = models.TextField("Descrição", blank=True)
    severidade = models.CharField(
        "Severidade",
        max_length=20,
        choices=Severity.choices
    )
    status = models.CharField(
        "Status da Vulnerabilidade",
        max_length=20,
        choices=StatusVulnerability.choices,
        default=StatusVulnerability.ABERTA
    )

    class Meta:
        verbose_name = "Vulnerabilidade"
        verbose_name_plural = "Vulnerabilidades"

    def __str__(self):
        return f"{self.cve or 'Sem CVE'} - {self.severidade}"
